# Remote Development with Distant.nvim

Complete guide for editing files on MIT cluster (or any remote server) using your local Neovim with full configuration support.

## Why Distant.nvim?

‚úÖ **Fast** - LSP runs on remote server (no network lag)
‚úÖ **Smart** - Only transfers what's needed (large log files stay remote)
‚úÖ **Complete** - Full local Neovim config works (all plugins, keybindings, AI tools)
‚úÖ **Reliable** - Auto-reconnects on network drops
‚úÖ **Efficient** - Perfect for moderate codebases with large files

## Installation

### 1. Install Distant CLI Locally (macOS)

Choose one method:

**Option A: Using Homebrew (Recommended)**
```bash
brew install distant
```

**Option B: Using Cargo**
```bash
cargo install distant
```

**Verify installation:**
```bash
distant --version
# Should show: distant 0.20.x or similar
```

### 2. Install Distant CLI on MIT Cluster

**SSH into your cluster:**
```bash
ssh brastmck@eofe10.mit.edu
```

**Then install distant:**

**Option A: Using Cargo (if available)**
```bash
cargo install distant
```

**Option B: Manual Download (if no Cargo)**
```bash
# Download latest binary
wget https://github.com/chipsenkbeil/distant/releases/latest/download/distant-x86_64-unknown-linux-gnu

# Make executable
chmod +x distant-x86_64-unknown-linux-gnu

# Move to bin directory
mkdir -p ~/.local/bin
mv distant-x86_64-unknown-linux-gnu ~/.local/bin/distant

# Add to PATH (add this to ~/.bashrc too)
export PATH="$HOME/.local/bin:$PATH"
```

**Verify installation:**
```bash
distant --version
# Should show: distant 0.20.x or similar
```

**IMPORTANT: Add to shell config**
```bash
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc
```

### 3. Reload Neovim Config

Back on your local machine:

```bash
# Restart Neovim or reload config
nvim
:Lazy sync
```

The plugin will auto-install on first use!

## Usage

### Quick Start (MIT Cluster)

1. **Open Neovim locally**
   ```bash
   nvim
   ```

2. **Launch distant server** (connects to MIT cluster)
   ```vim
   :DistantMIT
   ```

   This runs: `:DistantLaunch ssh://brastmck@eofe10.mit.edu`

   You'll be prompted for your password (or use SSH keys for passwordless login).

3. **Open remote files**

   **Option A: File browser**
   ```vim
   :DistantOpen
   ```
   Browse and select files interactively.

   **Option B: Direct path**
   ```vim
   :e distant://eofe10.mit.edu//home/brastmck/my-project/script.py
   ```

   Note: Double slash `//` after hostname for absolute paths!

4. **Edit normally!**
   - All your keybindings work
   - LSP works (fast!)
   - Claude Code, Codex, Avante all work
   - Large log files open instantly

### For Other Remote Hosts

```vim
" Generic connection
:DistantLaunch ssh://username@hostname

" Then open files
:e distant://hostname//path/to/file
```

## Keybindings

| Key | Command | Description |
|-----|---------|-------------|
| `<leader>rL` | `:DistantLaunch` | Launch server (connect to remote) |
| `<leader>rC` | `:DistantConnect` | Connect to existing server |
| `<leader>rD` | `:DistantSessionInfo` | Show session information |
| `<leader>ro` | `:DistantOpen` | Open remote file browser |

**Custom command for MIT:**
```vim
:DistantMIT  " Quick connect to MIT cluster
```

## Common Workflows

### Workflow 1: Edit Remote Project

```vim
" 1. Connect to cluster
:DistantMIT

" 2. Open project directory
:DistantOpen
" Navigate to: /home/brastmck/my-project/

" 3. Edit files
" Files open with full LSP, syntax highlighting, etc.

" 4. Use Telescope to navigate
<leader>ff   " Find files (works on remote!)
<leader>fg   " Live grep (searches remote files)

" 5. Save and exit normally
:w
:q
```

### Workflow 2: View Large Log Files

```vim
" 1. Connect
:DistantMIT

" 2. Open huge log file (doesn't transfer entire file!)
:e distant://eofe10.mit.edu//var/log/application.log

" 3. Search efficiently
/ERROR
n   " Next match

" 4. Jump to end
G

" Only the visible portions are transferred!
```

### Workflow 3: Code + Terminal Session

```vim
" Terminal 1: Local Neovim with distant
:DistantMIT
:e distant://eofe10.mit.edu//home/brastmck/project/code.py
" Edit with full local config

" Terminal 2: SSH for running code
ssh brastmck@eofe10.mit.edu
cd project
python code.py
```

## Passwordless SSH (Recommended)

To avoid typing password every time:

```bash
# Generate SSH key (if you don't have one)
ssh-keygen -t ed25519 -C "your_email@example.com"

# Copy to cluster
ssh-copy-id brastmck@eofe10.mit.edu

# Test
ssh brastmck@eofe10.mit.edu
# Should login without password!
```

Now `:DistantMIT` won't prompt for password.

## Troubleshooting

### "distant: command not found" on remote

**Problem:** Distant not in PATH on remote server.

**Solution:**
```bash
# SSH into remote
ssh brastmck@eofe10.mit.edu

# Check if distant exists
which distant
ls ~/.local/bin/distant

# If exists but not in PATH, add to ~/.bashrc
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc

# Verify
distant --version
```

### Connection hangs or times out

**Problem:** Network issues or firewall.

**Solution:**
```vim
" 1. Check if you can SSH normally
:!ssh brastmck@eofe10.mit.edu echo "Connected"

" 2. If SSH works, try distant with verbose output
:DistantLaunch ssh://brastmck@eofe10.mit.edu --log-level trace

" 3. Check session info
:DistantSessionInfo
```

### LSP not working on remote files

**Problem:** LSP servers might not be installed on remote.

**Solution:**
```bash
# SSH into remote
ssh brastmck@eofe10.mit.edu

# Install LSP servers you need
# Python
pip install python-lsp-server

# Node/TypeScript
npm install -g typescript-language-server

# Rust
rustup component add rust-analyzer

# Check if they work
pyls --version
typescript-language-server --version
```

### Large file still slow

**Problem:** Might be trying to load entire file.

**Solution:**
```vim
" Open large files in read-only mode
:view distant://host//path/to/huge.log

" Or disable syntax highlighting for large files
:syntax off
```

### Can't save files

**Problem:** Permission issues on remote.

**Solution:**
```bash
# SSH into remote and check permissions
ssh brastmck@eofe10.mit.edu
ls -la /path/to/file

# Fix permissions if needed
chmod u+w /path/to/file
```

## Advanced Configuration

### Auto-connect on Neovim start

Add to your `~/.config/nvim/init.lua`:

```lua
-- Auto-connect to MIT cluster
vim.api.nvim_create_autocmd("VimEnter", {
  pattern = "*",
  once = true,
  callback = function()
    -- Only auto-connect if no files opened
    if vim.fn.argc() == 0 then
      vim.defer_fn(function()
        vim.notify("Connecting to MIT cluster...", vim.log.levels.INFO)
        vim.cmd("DistantMIT")
      end, 1000)  -- Wait 1 second after startup
    end
  end
})
```

### Custom SSH options

```vim
" Connect with custom SSH options
:DistantLaunch ssh://brastmck@eofe10.mit.edu -o ServerAliveInterval=60 -o ServerAliveCountMax=3
```

### Save frequent paths

Add to your config:

```lua
-- Custom commands for frequent remote paths
vim.api.nvim_create_user_command('ProjectA', function()
  vim.cmd('e distant://eofe10.mit.edu//home/brastmck/project-a/')
end, {})

vim.api.nvim_create_user_command('Logs', function()
  vim.cmd('e distant://eofe10.mit.edu//var/log/')
end, {})
```

Then use:
```vim
:ProjectA  " Jump to project-a
:Logs      " Jump to logs directory
```

## Performance Tips

1. **Use SSH keys** - Eliminates password prompt delays
2. **Keep connection alive** - Use ServerAliveInterval in SSH config
3. **Disable heavy plugins** for remote files if needed:
   ```vim
   " Auto-detect distant files and optimize
   vim.api.nvim_create_autocmd("BufRead", {
     pattern = "distant://*",
     callback = function()
       -- Disable aggressive features for remote files
       vim.opt_local.updatetime = 2000
       vim.notify("Remote file - performance mode", vim.log.levels.INFO)
     end
   })
   ```

## Comparison with Alternatives

| Feature | Distant.nvim | SSHFS | Remote Nvim |
|---------|--------------|-------|-------------|
| Setup | Moderate | Easy | Easy |
| LSP Speed | ‚úÖ Fast | ‚ùå Slow | ‚úÖ Fast |
| Large Files | ‚úÖ Fast | ‚ùå Slow | ‚úÖ Fast |
| Local Config | ‚úÖ Yes | ‚úÖ Yes | ‚ùå No |
| AI Tools | ‚úÖ Works | ‚úÖ Works | ‚ùå Limited |
| Network Drop | ‚úÖ Auto-reconnect | ‚ùå Hangs | ‚ö†Ô∏è Session lost |

## Getting Help

- **Check sessions**: `:DistantSessionInfo`
- **View logs**: `:DistantClientVersion`
- **Plugin docs**: `:help distant`
- **GitHub**: https://github.com/chipsenkbeil/distant.nvim

## Summary

**Daily Workflow:**
1. Open Neovim: `nvim`
2. Connect: `:DistantMIT`
3. Browse: `:DistantOpen` or direct path
4. Edit with full local config!
5. Disconnect automatically when you `:q`

**Benefits:**
- ‚úÖ Full local Neovim config (all plugins, AI, keybindings)
- ‚úÖ Fast LSP (runs on remote)
- ‚úÖ Handles large files efficiently
- ‚úÖ Perfect for your moderate codebases + large logs

Enjoy seamless remote development! üöÄ
