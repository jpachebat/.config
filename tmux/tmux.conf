set-option -g history-limit 25000
set -g mouse on

# change prefix from C-b to C-Space
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# for neovim
set -sg escape-time 10
set-option -g focus-events on


# vi for copy mode
setw -g mode-keys vi

# status bar
set -g status-right "#(pomo)"
set -g status-style "fg=#665c54"
set -g status-left-style "fg=#928374"

set -g status-bg default
set -g status-position top
set -g status-interval 1
set -g status-left ""

# disable status
# set -g status off
# set -g status on

# apply shared theme (syncs with Alacritty/Nvim toggle script)
run-shell "~/.config/theme/apply-tmux.sh"

# count the panes from 1
set -g base-index 1
setw -g pane-base-index 1

# reload configuration
bind-key -r r source-file ~/.tmux.conf

# term colors, these are the correct ones according to neovim checkhealth
set-option -g default-terminal "screen-256color"

# ===== NESTED TMUX SESSION SUPPORT =====
# Toggle nested mode with F12 (standard practice)
# When enabled, local tmux passes all keys to inner/remote tmux
# Visual feedback: status bar dims when in nested mode

# Enter nested mode: F12
# Disables all local bindings, dims status bar, shows [NESTED] indicator
bind -n F12 \
  set prefix None \;\
  set key-table off \;\
  set status-style "fg=#504945,bg=#1d2021" \;\
  set status-left "#[fg=#fb4934,bg=#1d2021,bold] NESTED #[default] " \;\
  set window-status-current-style "fg=#504945,bg=#1d2021" \;\
  set window-status-current-format "#[fg=#504945,bg=#1d2021] #I:#W* " \;\
  if -F '#{pane_in_mode}' 'send-keys -X cancel' \;\
  refresh-client -S \;\
  display-message "NESTED MODE: Press F12 to exit"

# Exit nested mode: F12 (while in nested mode)
# Restores all local bindings and status bar
bind -T off F12 \
  set -u prefix \;\
  set -u key-table \;\
  set -u status-style \;\
  set status-left "" \;\
  set -u window-status-current-style \;\
  set -u window-status-current-format \;\
  refresh-client -S \;\
  display-message "LOCAL MODE: Controlling outer tmux"
